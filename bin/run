#!/usr/bin/env python

import time
import mido
from midihue import HueClient, HueStream


GROUP_ID = 2

client = HueClient()
stream = HueStream(GROUP_ID, client)
stream.start()

v1 = 0
v2 = 0
def handle_midi(msg):
    global v1, v2
    if msg.control == 77:
        v1 = msg.value << 9
    elif msg.control == 78:
        v2 = msg.value << 9


inport = mido.open_input('Launch Control XL')

while True:
    for msg in inport.iter_pending():
        handle_midi(msg)
    streammsg = HueStream.Message()
    streammsg.add(light_id=3, rgb=[v1, v2, 0])
    streammsg.add(light_id=4, rgb=[v2, v1, 0])
    stream.send(streammsg)
    time.sleep(0.01)
